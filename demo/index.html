<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>caas-investment demo</title>

    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>

    <link rel="import" href="../../iron-demo-helpers/demo-pages-shared-styles.html">
    <link rel="import" href="../../iron-demo-helpers/demo-snippet.html">
    <link rel="import" href="../caas-investment.html">
    <link rel="import" href="../../caas-auth/caas-auth.html">

    <style is="custom-style" include="demo-pages-shared-styles">
    </style>
  </head>
  <body>

    <template
      is="dom-bind"
      id="demo"
      >

      <h2>Sign in</h2>

      <template is="dom-if" if="[[!signedIn]]">
      <form on-submit="signIn">
        <label for="username">username</label><br>
        <input type="text" id="username" value="investor@caastest.local"><p>

        <label for="password">password</label><br>
        <input type="password" id="password" value="abc123"><p>

        <input type="submit" value="Sign In">
      </form>
      </template>
      
      <template is="dom-if" if="[[signedIn]]">
        <label for="token">signed in</label><br>
        <small>[[accessToken]]</small>
      </template>


      <h2>Select</h2>

      <form on-submit="showConsiderations">


      <label for="token">campaign id</label><br>
      <input type="text" value="{{campaignId::input}}" name="campaignId"><p>

      <label for="token">contract type id</label><br>
      <select on-change="setContractType">
        <option>kies...</option>
        <template is="dom-repeat" items="[[availableContractTypes]]">
          <option value="[[item.id]]">[[item.id]]</option>
        </template>
      </select><p>

      <label for="token">amount</label><br>
      <input
        type="number"
        value="{{amount::input}}"
        name="amount"
        min$="[[smallestAllowedAmount]]"
        max$="[[largestAllowedAmount]]"
        step$="[[amountStep]]"
      ><p>

      <label for="token">incentive id</label><br>
      <input type="text" value="{{incentiveId::input}}" name="incentiveId"><p>

      </form>

      <label for="token">aandachtspunten</label><br>
      <ul>
        <template is="dom-repeat" items="[[considerations]]">
          <li>[[item]]</li>
        </template>
      </ul>
      
      <caas-auth
        id="auth"
        api-endpoint="http://canapi.local"
        signed-in="{{signedIn}}"
      ></caas-auth>

      <caas-investment
        api-endpoint="http://canapi.local"
        access-token="[[accessToken]]"
        campaign-id="[[campaignId]]"
        contract-type-id="[[contractTypeId]]"
        available-contract-types="{{availableContractTypes}}"
        smallest-allowed-amount="{{smallestAllowedAmount}}"
        largest-allowed-amount="{{largestAllowedAmount}}"
        amount-step="{{amountStep}}"
        amount="[[amount]]"
        incentive-id="[[incentiveId]]"
        considerations="{{considerations}}"
      ></caas-investment>

    </template>

    <script>
      var d = document.querySelector('#demo');

      d.addEventListener('dom-change', function() {

        var auth = document.querySelector('#auth');
        var inv = document.querySelector('caas-investment');

        inv.campaignId = "429";

        d.signIn = function(evt) {
          evt.preventDefault();
          auth.signIn(
            document.querySelector('#username').value,
            document.querySelector('#password').value,
            'investor'
          );
        }

        d.setContractType = function(evt) {
          var contractTypeId = evt.target.options[evt.target.selectedIndex].text;
          inv.contractTypeId = contractTypeId
        }

        auth.addEventListener('signed-in', function(data) {
          d.accessToken = auth.accessToken;
        })

        auth.addEventListener('sign-in-error', function(data) {
          alert('error!');
        })

        // auth.signIn(
        //   'investor@caastest.local',
        //   'abc123',
        //   'investor'
        // );

      })


    </script>
  </body>
</html>
